<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finaliza tu pedido - Mejorada FS</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="encabezado">
    <div class="barra-superior">
      <div class="logo-container">
        <img src="escudo.png" alt="Escudo Mejorada FS" class="escudo">
        <span class="nombre-club">Mejorada FS</span>
      </div>
    </div>
  </header>

  <section class="pedido">
    <h2>Finaliza tu pedido</h2>

    <div id="resumen-pedido"></div>

    <form id="formulario-pedido" method="POST" action="https://formspree.io/f/xeovqrvj">
      <label>Nombre:
        <input type="text" name="nombre" required>
      </label>
      <label>Apellido:
        <input type="text" name="apellido" required>
      </label>
      <label>Teléfono:
        <input type="tel" name="telefono" required>
      </label>

      <input type="hidden" name="pedido_detalle" id="pedido_detalle">
      <input type="hidden" name="_subject" value="Nuevo pedido Mejorada FS">

      <button type="submit" class="btn-enviar">Enviar Pedido</button>
      <button type="button" class="boton-volver" onclick="history.back()">Volver atrás</button>
    </form>
  </section>

  <footer>
    <p>© 2025 Mejorada FS - Tienda Oficial</p>
  </footer>

  <script>
    // Recuperar el carrito guardado
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    const resumen = document.getElementById('resumen-pedido');
    let total = 0;

    if (carrito.length === 0) {
      resumen.innerHTML = "<p>No hay productos en el carrito.</p>";
    } else {
      resumen.innerHTML = "<h3>Tus productos seleccionados:</h3>";
      carrito.forEach(item => {
        const div = document.createElement('div');
        div.classList.add("item-pedido");
        div.innerHTML = `
          <p><strong>${item.nombre}</strong></p>
          <p>Talla: ${item.talla || "-"}</p>
          <p>Dorsal: ${item.numeroCamiseta || "-"}</p>
          <p>Precio: ${item.precio.toFixed(2)} €</p>
        `;
        resumen.appendChild(div);
        total += item.precio;
      });

      const totalP = document.createElement('p');
      totalP.classList.add("total-pedido");
      totalP.innerHTML = `<strong>Total a pagar: ${total.toFixed(2)} €</strong>`;
      resumen.appendChild(totalP);
    }

    // Guardar detalle del pedido
    document.getElementById('pedido_detalle').value = carrito.map(item => {
      return `${item.nombre} - Talla: ${item.talla || "-"} - Dorsal: ${item.numeroCamiseta || "-"} - ${item.precio.toFixed(2)} €`;
    }).join('\n') + `\n\nTotal: ${total.toFixed(2)} €`;

    // Opcional: enviar por AJAX y vaciar carrito al enviar
    document.getElementById('formulario-pedido').addEventListener('submit', async (e) => {
      // e.preventDefault(); // descomenta si quieres enviar por AJAX
      // localStorage.removeItem('carrito'); // vaciar carrito
      // window.location.href = "gracias.html"; // redirigir después
    });
  </script>
</body>
</html>

